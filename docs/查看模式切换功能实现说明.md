# 查看模式切换功能实现说明

## 📋 功能概述

实现了三种照片查看模式，用户可以通过底部切换器在不同模式间切换：
- **小图模式**：横向滚动网格，3列显示
- **大图模式**：横向滚动网格，2列显示  
- **详情列表模式**：垂直列表，显示照片的详细信息

## ✅ 实现内容

### 1. 核心类文件

#### ViewMode.kt（新增）
- 定义查看模式枚举：`SMALL_GRID`、`LARGE_GRID`、`DETAIL_LIST`

#### PhotoGridAdapter.kt（新增）
- 网格模式适配器，支持可配置的列数（spanCount）和图片高度
- 用于小图模式（3列）和大图模式（2列）
- 复用 `item_photo.xml` 布局

#### PhotoDetailListAdapter.kt（新增）
- 详情列表模式适配器
- 显示缩略图、照片名称、日期、文件大小和分辨率
- 使用新的布局文件 `item_photo_detail_list.xml`

#### PhotoGroupAdapter.kt（更新）
- 添加 `viewMode` 参数支持不同查看模式
- 添加 `updateViewMode()` 方法支持动态切换模式
- 根据模式选择不同的 LayoutManager 和 Adapter：
  - 小图模式：GridLayoutManager（横向，3列）+ PhotoGridAdapter
  - 大图模式：GridLayoutManager（横向，2列）+ PhotoGridAdapter
  - 详情列表模式：LinearLayoutManager（垂直）+ PhotoDetailListAdapter

#### MainActivity.kt（更新）
- 添加查看模式状态管理
- 使用 SharedPreferences 持久化用户选择的模式
- 添加模式切换 UI（ChipGroup）设置和事件处理
- 实现 `setupViewModeSwitcher()` 和 `updateViewMode()` 方法

### 2. 布局文件

#### activity_main.xml（更新）
- 添加底部 ChipGroup，包含三个 Chip：
  - 小图 Chip（smallGridChip）
  - 大图 Chip（largeGridChip）
  - 详情列表 Chip（detailListChip）
- 调整 SwipeRefreshLayout 布局，为底部 ChipGroup 留出空间

#### item_photo_detail_list.xml（新增）
- 详情列表模式的项目布局
- 包含：缩略图（80dp × 80dp）、照片名称、日期、文件大小和分辨率信息
- 使用 CardView 包装，Material Design 风格

### 3. 资源文件

#### dimens.xml（更新）
- 添加 `photo_item_height_small`：160dp（小图模式）
- 添加 `photo_item_height_large`：280dp（大图模式）

#### strings.xml（更新）
- 添加三个模式的中文标签：
  - `view_mode_small_grid`：小图
  - `view_mode_large_grid`：大图
  - `view_mode_detail_list`：详情列表

## 🎯 功能特性

### 模式切换
- ✅ 实时切换，无需重新加载数据
- ✅ 模式选择持久化（SharedPreferences）
- ✅ 应用重启后恢复上次选择的模式
- ✅ 视觉反馈（Chip 选中状态）

### 小图模式
- ✅ 横向滚动网格布局
- ✅ 3列显示
- ✅ 图片高度：160dp
- ✅ 显示时间戳

### 大图模式
- ✅ 横向滚动网格布局
- ✅ 2列显示
- ✅ 图片高度：280dp
- ✅ 显示时间戳

### 详情列表模式
- ✅ 垂直列表布局
- ✅ 显示缩略图（80dp × 80dp）
- ✅ 显示照片名称（加粗）
- ✅ 显示日期时间
- ✅ 显示文件大小和分辨率

## 🔧 技术实现

### 模式状态管理
```kotlin
// 使用 SharedPreferences 持久化
sharedPreferences.edit()
    .putString(PREF_VIEW_MODE, newViewMode.name)
    .apply()

// 恢复模式
val savedViewModeName = sharedPreferences.getString(PREF_VIEW_MODE, ViewMode.SMALL_GRID.name)
currentViewMode = ViewMode.valueOf(savedViewModeName ?: ViewMode.SMALL_GRID.name)
```

### 动态切换适配器
```kotlin
// PhotoGroupAdapter 根据模式创建不同的适配器
when (viewMode) {
    ViewMode.SMALL_GRID -> {
        holder.groupRecyclerView.layoutManager = GridLayoutManager(context, 3, HORIZONTAL, false)
        holder.groupRecyclerView.adapter = PhotoGridAdapter(context, photos, 3, 160dp, ...)
    }
    ViewMode.LARGE_GRID -> {
        holder.groupRecyclerView.layoutManager = GridLayoutManager(context, 2, HORIZONTAL, false)
        holder.groupRecyclerView.adapter = PhotoGridAdapter(context, photos, 2, 280dp, ...)
    }
    ViewMode.DETAIL_LIST -> {
        holder.groupRecyclerView.layoutManager = LinearLayoutManager(context, VERTICAL, false)
        holder.groupRecyclerView.adapter = PhotoDetailListAdapter(context, photos, ...)
    }
}
```

### 全局位置计算
- 保持正确的全局位置索引，确保点击照片后跳转到正确的详情页位置
- 在 `onBindViewHolder` 中计算当前日期组的起始位置

## 📊 UI 设计

### ChipGroup 设计
- 位置：屏幕底部
- 样式：圆角背景（group_header_background）
- 行为：单选模式（singleSelection="true"）
- 布局：水平排列，右对齐

### 布局约束
- SwipeRefreshLayout：底部约束到 ChipGroup 顶部
- ChipGroup：固定在屏幕底部，左右边距 16dp

## 🚀 使用流程

1. **启动应用**：自动加载上次保存的查看模式
2. **切换模式**：点击底部的 Chip 按钮
3. **即时生效**：列表立即更新为新模式
4. **持久保存**：模式选择自动保存到 SharedPreferences

## 🔄 数据流

```
用户点击 Chip
    ↓
MainActivity.updateViewMode()
    ↓
保存到 SharedPreferences
    ↓
PhotoGroupAdapter.updateViewMode()
    ↓
notifyDataSetChanged()
    ↓
onBindViewHolder() 根据新模式创建适配器
    ↓
RecyclerView 更新显示
```

## 📝 注意事项

1. **PhotoAdapter 保留**：虽然现在使用 PhotoGridAdapter，但保留了原始的 PhotoAdapter 以保持向后兼容
2. **内存管理**：切换模式时会重新创建适配器，但 RecyclerView 会自动回收 ViewHolder
3. **性能优化**：Glide 会自动处理图片缓存，不同模式之间切换不会重复加载图片
4. **详情列表模式**：使用较小的缩略图（160×160）以提升性能

## 🎨 视觉效果

- **小图模式**：紧凑的网格，适合快速浏览大量照片
- **大图模式**：更大的缩略图，适合查看照片细节
- **详情列表模式**：信息丰富，适合查看照片元数据

---

**实现时间**：2024
**状态**：✅ 已完成并测试通过
