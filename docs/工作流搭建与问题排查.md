# å·¥ä½œæµæ­å»ºä¸é—®é¢˜æ’æŸ¥

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº† GitHub Actions CI/CD å·¥ä½œæµçš„æ­å»ºè¿‡ç¨‹ï¼Œè®°å½•äº†é‡åˆ°çš„é—®é¢˜ã€æ’æŸ¥è¿‡ç¨‹å’Œè§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡æ¡£æ•´åˆäº†æ‰€æœ‰ç›¸å…³å·¥ä½œæµç›¸å…³çš„é—®é¢˜å¤„ç†æ–‡æ¡£ã€‚

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025å¹´1æœˆ  
**é€‚ç”¨é¡¹ç›®**ï¼šPhotoTimeGrouper Android åº”ç”¨  
**CI/CD å¹³å°**ï¼šGitHub Actions

---

## ä¸€ã€å·¥ä½œæµæ­å»ºæ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

å»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»ºçš„ CI/CD å·¥ä½œæµï¼Œå®ç°ï¼š
- âœ… è‡ªåŠ¨è¿è¡Œå•å…ƒæµ‹è¯•
- âœ… è‡ªåŠ¨æ„å»º Debug APK
- âœ… ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- âœ… åœ¨ PR å’Œ Commit ä¸­æ˜¾ç¤ºæµ‹è¯•ç»“æœ

### 1.2 åˆ›å»ºçš„å·¥ä½œæµ

**å·¥ä½œæµ 1ï¼šæ„å»ºå’Œæµ‹è¯•** (`.github/workflows/build-and-test.yml`)
- è§¦å‘æ¡ä»¶ï¼šPush åˆ° `main` åˆ†æ”¯ã€Pull Request
- åŠŸèƒ½ï¼šæ„å»º APKã€è¿è¡Œæµ‹è¯•ã€ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šã€ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š

**å·¥ä½œæµ 2ï¼šå•å…ƒæµ‹è¯•** (`.github/workflows/test.yml`)
- è§¦å‘æ¡ä»¶ï¼šPush åˆ° `main`/`develop` åˆ†æ”¯ã€Pull Request
- åŠŸèƒ½ï¼šå¿«é€Ÿè¿è¡Œå•å…ƒæµ‹è¯•ã€ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šã€åˆ›å»º Check Run

---

## äºŒã€é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 2.1 Gradle Wrapper é—®é¢˜

#### é—®é¢˜ç°è±¡

**æœ¬åœ°é”™è¯¯ï¼š**
```
é”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» org.gradle.wrapper.GradleWrapperMain
åŸå› : java.lang.ClassNotFoundException: org.gradle.wrapper.GradleWrapperMain
```

**CI é”™è¯¯ï¼š**
```
no main manifest attribute, in ./gradle/wrapper/gradle-wrapper.jar
Error: Process completed with exit code 1.
```

#### é—®é¢˜æ ¹æº

**é”™è¯¯åˆ¤æ–­è¿‡ç¨‹ï¼š**
1. **åˆæ­¥åˆ¤æ–­**ï¼šæ ¹æ®æ–‡ä»¶å¤§å°ï¼ˆ42-43 KB vs æ­£å¸¸çš„ 60-70 KBï¼‰ï¼Œè®¤ä¸ºæ–‡ä»¶ä¸å®Œæ•´æˆ–æŸå
2. **æ·±å…¥æ’æŸ¥**ï¼šè™½ç„¶æ–‡ä»¶å¤§å°çœ‹èµ·æ¥å¼‚å¸¸ï¼Œä½†å®é™…è¿è¡Œ `gradlew --version` åœ¨æœ¬åœ°æ˜¯å¯ä»¥å·¥ä½œçš„
3. **çœŸæ­£åŸå› **ï¼šJAR æ–‡ä»¶çš„ `META-INF/MANIFEST.MF` ä¸­**ç¼ºå°‘ Main-Class å±æ€§**ï¼Œå¯¼è‡´æ— æ³•é€šè¿‡ `java -jar` ç›´æ¥æ‰§è¡Œ

**æ ¹æœ¬åŸå› åˆ†æï¼š**
- âŒ **ä¸æ˜¯æ–‡ä»¶å¤§å°é—®é¢˜**ï¼š42-43 KB å¯èƒ½ä¹Ÿæ˜¯æ­£å¸¸çš„å¤§å°ï¼Œåªæ˜¯ä¸åŒç‰ˆæœ¬/æ„å»ºæ–¹å¼å¯¼è‡´çš„å·®å¼‚
- âœ… **çœŸæ­£é—®é¢˜**ï¼š`META-INF/MANIFEST.MF` æ–‡ä»¶ä¸­ç¼ºå°‘ `Main-Class: org.gradle.wrapper.GradleWrapperMain`
- **ä¸ºä»€ä¹ˆæœ¬åœ°å¯ä»¥å·¥ä½œ**ï¼š`gradlew` è„šæœ¬é€šè¿‡ `-classpath` æ–¹å¼æŒ‡å®šä¸»ç±»è¿è¡Œï¼Œä¸ä¾èµ– MANIFEST.MF ä¸­çš„ Main-Class
- **ä¸ºä»€ä¹ˆ CI å¤±è´¥**ï¼šCI ç¯å¢ƒä¸­å¯èƒ½ç›´æ¥ä½¿ç”¨ `java -jar gradle-wrapper.jar` æ‰§è¡Œï¼Œéœ€è¦ MANIFEST.MF ä¸­çš„ Main-Class å±æ€§

**éªŒè¯æ–¹æ³•ï¼š**
```powershell
# æ£€æŸ¥ JAR æ–‡ä»¶å†…å®¹ï¼ˆéœ€è¦è§£å‹æŸ¥çœ‹ï¼‰
# æ­£å¸¸çš„ gradle-wrapper.jar åº”è¯¥åŒ…å«ï¼š
# META-INF/MANIFEST.MF
#   Main-Class: org.gradle.wrapper.GradleWrapperMain

# ç›´æ¥è¿è¡Œ JAR éªŒè¯ï¼ˆå¦‚æœç¼ºå°‘ Main-Classï¼Œä¼šæŠ¥é”™ï¼‰
java -jar gradle/wrapper/gradle-wrapper.jar --version
# æ­£å¸¸åº”è¯¥è¾“å‡º Gradle ç‰ˆæœ¬ä¿¡æ¯
# é”™è¯¯ä¼šæ˜¾ç¤º: no main manifest attribute
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Gradle é‡æ–°ç”Ÿæˆï¼ˆæœ€ç»ˆæ–¹æ¡ˆï¼‰**
```powershell
# ä½¿ç”¨å·²å®‰è£…çš„ Gradle ç”Ÿæˆ wrapper
gradle wrapper --gradle-version=8.5
```

**æ–¹æ¡ˆ 2ï¼šæ·»åŠ  `.gitattributes`ï¼ˆé¢„é˜²æªæ–½ï¼‰**
```gitattributes
gradle/wrapper/gradle-wrapper.jar binary
```
ç¡®ä¿ Git å°† JAR æ–‡ä»¶è§†ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸è¿›è¡Œæ–‡æœ¬è½¬æ¢ã€‚

**æ–¹æ¡ˆ 3ï¼šæ‰‹åŠ¨ä¿®å¤ MANIFEST.MFï¼ˆå¦‚æœæ— æ³•é‡æ–°ç”Ÿæˆï¼‰**
å¦‚æœæ— æ³•é‡æ–°ç”Ÿæˆ wrapperï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®å¤ MANIFEST.MFï¼š

1. è§£å‹ JAR æ–‡ä»¶
2. åˆ›å»º/ç¼–è¾‘ `META-INF/MANIFEST.MF`ï¼Œæ·»åŠ ï¼š
   ```
   Main-Class: org.gradle.wrapper.GradleWrapperMain
   ```
3. é‡æ–°æ‰“åŒ… JAR æ–‡ä»¶

**æ³¨æ„**ï¼šæ­¤æ–¹æ³•å¤æ‚ä¸”å®¹æ˜“å‡ºé”™ï¼Œä¼˜å…ˆä½¿ç”¨æ–¹æ¡ˆ 1ã€‚

**æ–¹æ¡ˆ 4ï¼šCI ç¯å¢ƒè‡ªåŠ¨ä¿®å¤ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰**
åœ¨å·¥ä½œæµä¸­æ·»åŠ è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤é€»è¾‘ï¼ˆå·²ä»å·¥ä½œæµä¸­ç§»é™¤ï¼Œå› ä¸ºæ–‡ä»¶å·²ä¿®å¤ï¼‰ã€‚

#### è§£å†³ç»“æœ

- âœ… `gradle-wrapper.jar` æ–‡ä»¶å¤§å°ï¼š60-70 KBï¼ˆæ­£å¸¸ï¼‰
- âœ… æœ¬åœ° `gradlew --version` æ­£å¸¸è¿è¡Œ
- âœ… æœ¬åœ° `gradlew test` æ­£å¸¸è¿è¡Œ
- âœ… CI ç¯å¢ƒå·¥ä½œæµæ­£å¸¸è¿è¡Œ

---

### 2.2 æµ‹è¯•ç»“æœè·¯å¾„é—®é¢˜

#### é—®é¢˜ç°è±¡

CI å·¥ä½œæµæŠ¥é”™ï¼š
```
Warning: No file matches path app/build/test-results/test/*.xml
Error: No test report files were found
```

#### é—®é¢˜æ ¹æº

Android Gradle Plugin 8.0+ ä½¿ç”¨ä¸åŒçš„æµ‹è¯•ç»“æœè·¯å¾„ï¼š
- **æ—§è·¯å¾„**ï¼ˆAGP 7.xï¼‰ï¼š`app/build/test-results/test/`
- **æ–°è·¯å¾„**ï¼ˆAGP 8.0+ï¼‰ï¼š`app/build/test-results/testDebugUnitTest/`

å·¥ä½œæµé…ç½®ä½¿ç”¨äº†æ—§è·¯å¾„ï¼Œå¯¼è‡´æ— æ³•æ‰¾åˆ°æµ‹è¯•ç»“æœæ–‡ä»¶ã€‚

#### è§£å†³æ–¹æ¡ˆ

æ›´æ–°å·¥ä½œæµé…ç½®ä¸­çš„æµ‹è¯•è·¯å¾„ï¼š

**`build-and-test.yml`ï¼š**
```yaml
- name: è¿è¡Œå•å…ƒæµ‹è¯•
  run: ./gradlew testDebugUnitTest --no-daemon

- name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
  path: |
    app/build/reports/tests/testDebugUnitTest/
    app/build/test-results/testDebugUnitTest/
```

**`test.yml`ï¼š**
```yaml
- name: è¿è¡Œå•å…ƒæµ‹è¯•
  run: ./gradlew testDebugUnitTest --no-daemon

- name: ä¸Šä¼ æµ‹è¯•ç»“æœ
  uses: dorny/test-reporter@v1
  with:
    path: app/build/test-results/testDebugUnitTest/*.xml
```

#### è§£å†³ç»“æœ

- âœ… æµ‹è¯•ç»“æœæ­£ç¡®ä¸Šä¼ åˆ° Artifacts
- âœ… æµ‹è¯•æ‘˜è¦æ­£ç¡®æ˜¾ç¤ºåœ¨ Job Summary
- âœ… `dorny/test-reporter` æ­£ç¡®åˆ›å»º Check Runs

---

### 2.3 æƒé™é…ç½®é—®é¢˜

#### é—®é¢˜ç°è±¡

CI å·¥ä½œæµæŠ¥é”™ï¼š
```
Error: HttpError: Resource not accessible by integration
```

#### é—®é¢˜æ ¹æº

`dorny/test-reporter` éœ€è¦åˆ›å»º GitHub Check Runsï¼Œä½†å·¥ä½œæµæ²¡æœ‰é…ç½®ç›¸åº”æƒé™ã€‚GitHub Actions é»˜è®¤æƒé™ä¸è¶³ä»¥åˆ›å»º Check Runsã€‚

#### è§£å†³æ–¹æ¡ˆ

åœ¨å·¥ä½œæµçš„ job ä¸­æ·»åŠ  `permissions` é…ç½®ï¼š

```yaml
jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      checks: write    # å…è®¸åˆ›å»ºå’Œæ›´æ–° Check Runs
      contents: read  # å…è®¸è¯»å–ä»“åº“å†…å®¹
```

#### è§£å†³ç»“æœ

- âœ… `dorny/test-reporter` æˆåŠŸåˆ›å»º Check Runs
- âœ… æµ‹è¯•ç»“æœåœ¨ PR å’Œ Commit é¡µé¢æ­£ç¡®æ˜¾ç¤º

---

### 2.4 Kotlin ç¼–è¯‘é”™è¯¯

#### é—®é¢˜ç°è±¡

CI æ„å»ºå¤±è´¥ï¼š
```
e: file:///.../PhotoMetadataLoader.kt:77:61 Expecting '\"'
Unresolved reference: denominator
```

#### é—®é¢˜æ ¹æº

Kotlin å­—ç¬¦ä¸²æ¨¡æ¿è¯­æ³•é”™è¯¯ï¼š
```kotlin
// é”™è¯¯å†™æ³•
"$denominator"  // åœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­å¯èƒ½æ— æ³•æ­£ç¡®è§£æ

// æ­£ç¡®å†™æ³•
"${denominator}"  // æ˜¾å¼å­—ç¬¦ä¸²æ¨¡æ¿
```

#### è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹ `PhotoMetadataLoader.kt`ï¼š
```kotlin
// ä¿®å¤å‰
val format = "$denominator"

// ä¿®å¤å
val format = "${denominator}"
```

---

### 2.5 Java ç¯å¢ƒè·¯å¾„é—®é¢˜

#### é—®é¢˜ç°è±¡

CI æ„å»ºå¤±è´¥ï¼š
```
Java home supplied is invalid: C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.17.10-hotspot
```

#### é—®é¢˜æ ¹æº

`gradle.properties` ä¸­é…ç½®äº† Windows æœ¬åœ°è·¯å¾„ï¼ŒCI ç¯å¢ƒï¼ˆLinuxï¼‰æ— æ³•è®¿é—®ã€‚

#### è§£å†³æ–¹æ¡ˆ

æ³¨é‡Šæ‰ `gradle.properties` ä¸­çš„æœ¬åœ°è·¯å¾„é…ç½®ï¼š
```properties
# org.gradle.java.home=C:\\Program Files\\Eclipse Adoptium\\jdk-17.0.17.10-hotspot
```

è®© CI ç¯å¢ƒä½¿ç”¨é»˜è®¤çš„ Java ç¯å¢ƒã€‚

---

## ä¸‰ã€å·¥ä½œæµé…ç½®è¯¦è§£

### 3.1 `build-and-test.yml` å·¥ä½œæµ

**åŠŸèƒ½**ï¼šå®Œæ•´çš„æ„å»ºå’Œæµ‹è¯•æµç¨‹

**æ­¥éª¤**ï¼š
1. æ£€å‡ºä»£ç 
2. è®¾ç½® JDK 17
3. è®¾ç½® Android SDK
4. æˆäºˆ gradlew æ‰§è¡Œæƒé™
5. æ£€æŸ¥ gradle-wrapper.jar
6. æ„å»º Debug APK
7. è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆ`testDebugUnitTest`ï¼‰
8. ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ˆJaCoCoï¼‰
9. ä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆAPKï¼‰
10. ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
11. ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
12. æ˜¾ç¤ºæµ‹è¯•æ‘˜è¦

**å…³é”®é…ç½®**ï¼š
```yaml
- name: è¿è¡Œå•å…ƒæµ‹è¯•
  run: ./gradlew testDebugUnitTest --no-daemon
  continue-on-error: true  # å³ä½¿æµ‹è¯•å¤±è´¥ä¹Ÿç»§ç»­æ‰§è¡Œ

- name: æ˜¾ç¤ºæµ‹è¯•æ‘˜è¦
  if: always()
  run: |
    echo "## æµ‹è¯•ç»“æœæ‘˜è¦" >> $GITHUB_STEP_SUMMARY
    if ls app/build/test-results/testDebugUnitTest/TEST-*.xml 1> /dev/null 2>&1; then
      echo "âœ… æµ‹è¯•å·²å®Œæˆ" >> $GITHUB_STEP_SUMMARY
      # ... æ˜¾ç¤ºæµ‹è¯•æ–‡ä»¶åˆ—è¡¨
    fi
```

---

### 3.2 `test.yml` å·¥ä½œæµ

**åŠŸèƒ½**ï¼šå¿«é€Ÿå•å…ƒæµ‹è¯•ï¼ˆè½»é‡çº§ï¼‰

**æ­¥éª¤**ï¼š
1. æ£€å‡ºä»£ç 
2. è®¾ç½® JDK 17
3. æˆäºˆ gradlew æ‰§è¡Œæƒé™
4. è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆ`testDebugUnitTest`ï¼‰
5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼ˆä¸Šä¼  Artifactï¼‰
6. ä¸Šä¼ æµ‹è¯•ç»“æœï¼ˆåˆ›å»º Check Runï¼‰

**å…³é”®é…ç½®**ï¼š
```yaml
permissions:
  checks: write
  contents: read

- name: ä¸Šä¼ æµ‹è¯•ç»“æœ
  uses: dorny/test-reporter@v1
  with:
    name: å•å…ƒæµ‹è¯•ç»“æœ
    path: app/build/test-results/testDebugUnitTest/*.xml
    reporter: java-junit
    fail-on-error: false
    fail-on-empty: false
```

---

## å››ã€æµ‹è¯•è¦†ç›–ç‡é…ç½®

### 4.1 JaCoCo é…ç½®

**`build.gradle`ï¼ˆé¡¹ç›®çº§ï¼‰ï¼š**
```gradle
plugins {
    id 'jacoco' version '0.8.11'
}
```

**`app/build.gradle`ï¼ˆåº”ç”¨çº§ï¼‰ï¼š**
```gradle
apply plugin: 'jacoco'

jacoco {
    toolVersion = "0.8.11"
}

tasks.register('jacocoTestReport', JacocoReport) {
    dependsOn 'testDebugUnitTest'
    
    reports {
        xml.required = true
        html.required = true
        html.outputLocation = layout.buildDirectory.dir('reports/jacoco/jacocoTestReport')
    }
    
    // é…ç½®æºä»£ç å’Œç±»æ–‡ä»¶è·¯å¾„
    // ...
}
```

### 4.2 è¦†ç›–ç‡æŠ¥å‘Šä½ç½®

- **HTML æŠ¥å‘Š**ï¼š`app/build/reports/jacoco/jacocoTestReport/html/index.html`
- **XML æŠ¥å‘Š**ï¼š`app/build/reports/jacoco/jacocoTestReport/jacocoTestReport.xml`
- **CI ä¸Šä¼ **ï¼šArtifact `coverage-reports`

---

## äº”ã€å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—

### 5.1 å·¥ä½œæµæ²¡æœ‰è‡ªåŠ¨è§¦å‘

**å¯èƒ½åŸå› **ï¼š
- æ–‡ä»¶æ²¡æœ‰æ­£ç¡® push
- å·¥ä½œæµæ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯
- åˆ†æ”¯åç§°ä¸åŒ¹é…

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥ `.github/workflows/` ç›®å½•ä¸­çš„ YAML æ–‡ä»¶
2. ç¡®è®¤è§¦å‘æ¡ä»¶ï¼ˆ`on: push: branches: [ main ]`ï¼‰
3. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²æäº¤å¹¶ push

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
git add .github/workflows/
git commit -m "Add workflows"
git push origin main
```

---

### 5.2 æµ‹è¯•æ­¥éª¤å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æµ‹è¯•ä»£ç æœ‰ç¼–è¯‘é”™è¯¯
- ä¾èµ–ç¼ºå¤±
- æµ‹è¯•ç”¨ä¾‹æœ¬èº«æœ‰é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹å·¥ä½œæµæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
2. åœ¨æœ¬åœ°è¿è¡Œ `./gradlew testDebugUnitTest` æ£€æŸ¥
3. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šè·å–è¯¦ç»†ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®å¤ç¼–è¯‘é”™è¯¯
- æ·»åŠ ç¼ºå¤±çš„ä¾èµ–
- ä¿®å¤æµ‹è¯•ç”¨ä¾‹é€»è¾‘

---

### 5.3 æµ‹è¯•æŠ¥å‘Šæœªæ‰¾åˆ°

**å¯èƒ½åŸå› **ï¼š
- æµ‹è¯•è·¯å¾„é…ç½®é”™è¯¯
- æµ‹è¯•ä»»åŠ¡æœªæ‰§è¡Œ
- Android Gradle Plugin ç‰ˆæœ¬å¯¼è‡´è·¯å¾„å˜åŒ–

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥å·¥ä½œæµä¸­ä½¿ç”¨çš„æµ‹è¯•ä»»åŠ¡åç§°
2. ç¡®è®¤æµ‹è¯•ç»“æœè·¯å¾„ï¼ˆAGP 8.0+ ä½¿ç”¨ `testDebugUnitTest`ï¼‰
3. æŸ¥çœ‹å·¥ä½œæµæ—¥å¿—ä¸­çš„æ–‡ä»¶åˆ—è¡¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ›´æ–°æµ‹è¯•è·¯å¾„ä¸º `testDebugUnitTest/*.xml`
- ç¡®ä¿ä½¿ç”¨ `testDebugUnitTest` ä»»åŠ¡è€Œé `test`

---

### 5.4 Check Run åˆ›å»ºå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- ç¼ºå°‘ `checks: write` æƒé™
- `dorny/test-reporter` é…ç½®é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥å·¥ä½œæµä¸­çš„ `permissions` é…ç½®
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­çš„æƒé™æç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
permissions:
  checks: write
  contents: read
```

---

### 5.5 Gradle Wrapper é—®é¢˜

**é—®é¢˜**ï¼š`gradle-wrapper.jar` æ‰§è¡Œå¤±è´¥ï¼ˆ`no main manifest attribute`ï¼‰

**æ’æŸ¥æ­¥éª¤**ï¼š
1. **éªŒè¯é”™è¯¯ä¿¡æ¯**ï¼šæ˜ç¡®æ˜¯ MANIFEST.MF é—®é¢˜è¿˜æ˜¯æ–‡ä»¶æŸå
   ```bash
   # ç›´æ¥è¿è¡Œ JAR éªŒè¯
   java -jar gradle/wrapper/gradle-wrapper.jar --version
   # å¦‚æœæŠ¥é”™ "no main manifest attribute"ï¼Œè¯´æ˜æ˜¯ MANIFEST.MF é—®é¢˜
   ```

2. **æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§**ï¼ˆéä¸»è¦é—®é¢˜ï¼‰
   - âš ï¸ **ä¸è¦ä»…å‡­æ–‡ä»¶å¤§å°åˆ¤æ–­**ï¼š42-70 KB éƒ½å¯èƒ½æ­£å¸¸
   - âœ… **é‡ç‚¹æ£€æŸ¥ MANIFEST.MF** æ˜¯å¦åŒ…å« Main-Class å±æ€§

3. **éªŒè¯æœ¬åœ°è¿è¡Œ**ï¼š
   ```bash
   # gradlew è„šæœ¬å¯ä»¥è¿è¡Œï¼ˆä¸ä¾èµ– MANIFEST.MFï¼‰
   ./gradlew --version
   ```

4. **æ£€æŸ¥ `.gitattributes` é…ç½®**ï¼šç¡®ä¿äºŒè¿›åˆ¶æ–‡ä»¶ä¸è¢« Git ä¿®æ”¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# æœ€ä½³æ–¹æ¡ˆï¼šé‡æ–°ç”Ÿæˆ wrapperï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºæ­£ç¡®çš„ MANIFEST.MFï¼‰
gradle wrapper --gradle-version=8.5

# éªŒè¯ä¿®å¤
java -jar gradle/wrapper/gradle-wrapper.jar --version
# åº”è¯¥è¾“å‡º Gradle ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸å†æŠ¥é”™
```

**å…³é”®ç‚¹**ï¼š
- âŒ **ä¸è¦ä»…å‡­æ–‡ä»¶å¤§å°åˆ¤æ–­**ï¼ˆå¯èƒ½è¯¯å¯¼ï¼Œ42-70 KB éƒ½å¯èƒ½æ­£å¸¸ï¼‰
- âœ… **çœŸæ­£æ£€æŸ¥ç‚¹æ˜¯ MANIFEST.MF ä¸­çš„ Main-Class å±æ€§**
- âœ… **é€šè¿‡ `java -jar` ç›´æ¥è¿è¡ŒéªŒè¯æœ€å¯é **

---

## å…­ã€æœ€ä½³å®è·µ

### 6.1 å·¥ä½œæµè®¾è®¡

1. **ä½¿ç”¨ `continue-on-error: true`** ç¡®ä¿æµ‹è¯•å¤±è´¥ä¸å½±å“åç»­æ­¥éª¤
2. **ä½¿ç”¨ `if: always()`** ç¡®ä¿æŠ¥å‘Šä¸Šä¼ æ­¥éª¤æ€»æ˜¯æ‰§è¡Œ
3. **åˆ†ç¦»è½»é‡çº§å’Œå®Œæ•´å·¥ä½œæµ** æä¾›å¿«é€Ÿåé¦ˆå’Œå®Œæ•´éªŒè¯
4. **é…ç½®æƒé™æœ€å°åŒ–** åªæˆäºˆå¿…éœ€çš„æƒé™

### 6.2 æµ‹è¯•è·¯å¾„ç®¡ç†

1. **ä½¿ç”¨å˜é‡** ç»Ÿä¸€ç®¡ç†æµ‹è¯•è·¯å¾„ï¼ˆé¿å…ç¡¬ç¼–ç ï¼‰
2. **é€‚é… AGP ç‰ˆæœ¬** æ³¨æ„ä¸åŒç‰ˆæœ¬è·¯å¾„å·®å¼‚
3. **ä½¿ç”¨é€šé…ç¬¦** `*.xml` åŒ¹é…æ‰€æœ‰æµ‹è¯•ç»“æœæ–‡ä»¶

### 6.3 é”™è¯¯å¤„ç†

1. **è¯¦ç»†æ—¥å¿—** ä½¿ç”¨ `--stacktrace` è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **é”™è¯¯è¿‡æ»¤** ä½¿ç”¨ `grep` ç­›é€‰å…³é”®é”™è¯¯ä¿¡æ¯
3. **è¯Šæ–­æ­¥éª¤** æ·»åŠ æ–‡ä»¶åˆ—è¡¨å’Œç›®å½•ç»“æ„æ£€æŸ¥

---

## ä¸ƒã€æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

### 7.1 GitHub Actions Artifacts

1. è®¿é—®ä»“åº“çš„ "Actions" æ ‡ç­¾
2. é€‰æ‹©æœ€æ–°çš„å·¥ä½œæµè¿è¡Œ
3. æ»šåŠ¨åˆ°åº•éƒ¨çš„ "Artifacts" éƒ¨åˆ†
4. ä¸‹è½½ä»¥ä¸‹äº§ç‰©ï¼š
   - `test-reports` - å•å…ƒæµ‹è¯•æŠ¥å‘Šï¼ˆHTML + XMLï¼‰
   - `coverage-reports` - æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ˆJaCoCoï¼‰

### 7.2 Job Summary

åœ¨å·¥ä½œæµè¿è¡Œé¡µé¢ç›´æ¥æŸ¥çœ‹ï¼š
- æµ‹è¯•ç»“æœæ‘˜è¦
- æµ‹è¯•æ–‡ä»¶åˆ—è¡¨
- æµ‹è¯•é€šè¿‡/å¤±è´¥çŠ¶æ€

### 7.3 Check Runs

åœ¨ PR æˆ– Commit é¡µé¢æŸ¥çœ‹ï¼š
- "å•å…ƒæµ‹è¯•ç»“æœ" Check Run
- è¯¦ç»†çš„æµ‹è¯•æ‘˜è¦
- å¤±è´¥æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯

---

## å…«ã€å®Œæˆçš„å·¥ä½œæ€»ç»“

### 8.1 å·¥ä½œæµåˆ›å»º

- âœ… åˆ›å»º `build-and-test.yml` - å®Œæ•´æ„å»ºæµ‹è¯•æµç¨‹
- âœ… åˆ›å»º `test.yml` - å¿«é€Ÿå•å…ƒæµ‹è¯•æµç¨‹
- âœ… é…ç½®æµ‹è¯•æŠ¥å‘Šä¸Šä¼ 
- âœ… é…ç½®è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ

### 8.2 é—®é¢˜ä¿®å¤

- âœ… ä¿®å¤ `gradle-wrapper.jar` æ–‡ä»¶ï¼ˆé‡æ–°ç”Ÿæˆï¼‰
- âœ… ä¿®å¤æµ‹è¯•ç»“æœè·¯å¾„ï¼ˆé€‚é… AGP 8.0+ï¼‰
- âœ… ä¿®å¤æƒé™é…ç½®ï¼ˆæ·»åŠ  `checks: write`ï¼‰
- âœ… ä¿®å¤ Kotlin ç¼–è¯‘é”™è¯¯ï¼ˆå­—ç¬¦ä¸²æ¨¡æ¿ï¼‰
- âœ… ä¿®å¤ Java ç¯å¢ƒè·¯å¾„é—®é¢˜ï¼ˆæ³¨é‡Šæœ¬åœ°è·¯å¾„ï¼‰

### 8.3 æµ‹è¯•æ¡†æ¶

- âœ… é…ç½® JaCoCo æµ‹è¯•è¦†ç›–ç‡å·¥å…·
- âœ… åˆ›å»ºå•å…ƒæµ‹è¯•æ–‡ä»¶ï¼ˆ62+ ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ä¹ã€å…³é”®æ–‡ä»¶æ¸…å•

### 9.1 å·¥ä½œæµæ–‡ä»¶

- `.github/workflows/build-and-test.yml` - æ„å»ºå’Œæµ‹è¯•å·¥ä½œæµ
- `.github/workflows/test.yml` - å•å…ƒæµ‹è¯•å·¥ä½œæµ

### 9.2 é…ç½®æ–‡ä»¶

- `.gitattributes` - Git å±æ€§é…ç½®ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ï¼‰
- `gradle.properties` - Gradle é…ç½®ï¼ˆå·²æ³¨é‡Šæœ¬åœ° Java è·¯å¾„ï¼‰
- `app/build.gradle` - åº”ç”¨æ„å»ºé…ç½®ï¼ˆJaCoCo æ’ä»¶ï¼‰
- `build.gradle` - é¡¹ç›®æ„å»ºé…ç½®ï¼ˆJaCoCo classpathï¼‰

### 9.3 æµ‹è¯•æ–‡ä»¶

- `app/src/test/java/com/phototimegrouper/app/MainActivityLogicTest.kt`
- `app/src/test/java/com/phototimegrouper/app/PhotoItemExtendedTest.kt`
- `app/src/test/java/com/phototimegrouper/app/PhotoItemTest.kt`
- `app/src/test/java/com/phototimegrouper/app/DateFormatterTest.kt`

---

## åã€ç»éªŒæ€»ç»“

### 10.1 é‡è¦æ•™è®­

1. **ä¸è¦ä»…å‡­æ–‡ä»¶å¤§å°åˆ¤æ–­é—®é¢˜** 
   - âŒ æœ€åˆè®¤ä¸º 42 KB çš„æ–‡ä»¶å¤§å°å¼‚å¸¸ï¼ˆä½†å®é™…ä¸Šå¯èƒ½æ˜¯æ­£å¸¸çš„ï¼‰
   - âœ… çœŸæ­£é—®é¢˜æ˜¯ JAR æ–‡ä»¶çš„ `META-INF/MANIFEST.MF` ä¸­**ç¼ºå°‘ Main-Class å±æ€§**
   - **æ•™è®­**ï¼šæ–‡ä»¶å¤§å°å¯èƒ½æœ‰æ­£å¸¸å·®å¼‚ï¼Œéœ€è¦æ·±å…¥åˆ†æé”™è¯¯ä¿¡æ¯ï¼Œä¸èƒ½ä»…å‡­å¤§å°åˆ¤æ–­

2. **ç†è§£ JAR æ–‡ä»¶çš„æ‰§è¡Œæ–¹å¼å·®å¼‚**
   - `java -jar gradle-wrapper.jar` éœ€è¦ MANIFEST.MF ä¸­çš„ Main-Class å±æ€§
   - `gradlew` è„šæœ¬é€šè¿‡ `-classpath` æ–¹å¼æŒ‡å®šä¸»ç±»è¿è¡Œï¼Œä¸ä¾èµ– MANIFEST.MF
   - **è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆæœ¬åœ° `gradlew --version` å¯ä»¥è¿è¡Œï¼Œä½† CI ä¸­ç›´æ¥ `java -jar` ä¼šå¤±è´¥**

3. **äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦ `.gitattributes`** é˜²æ­¢ Git æŸå JAR æ–‡ä»¶
4. **AGP ç‰ˆæœ¬å½±å“è·¯å¾„** ä¸åŒç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„æµ‹è¯•ç»“æœè·¯å¾„
5. **æƒé™å¿…é¡»æ˜¾å¼é…ç½®** CI ç¯å¢ƒéœ€è¦æ˜ç¡®é…ç½®æƒé™
6. **æœ¬åœ°ä¸ CI ç¯å¢ƒå·®å¼‚** æ³¨æ„è·¯å¾„å’Œç¯å¢ƒçš„å·®å¼‚

### 10.2 æ¨èåšæ³•

1. **ç»Ÿä¸€æµ‹è¯•ä»»åŠ¡åç§°** ä½¿ç”¨ `testDebugUnitTest` è€Œé `test`
2. **è¯¦ç»†æ—¥å¿—è¾“å‡º** ä½¿ç”¨ `--stacktrace` å’Œè¯Šæ–­æ­¥éª¤
3. **æ¸è¿›å¼é—®é¢˜æ’æŸ¥** å…ˆä¿®å¤åŸºç¡€é—®é¢˜ï¼Œå†è§£å†³é«˜çº§é—®é¢˜
4. **æ–‡æ¡£è®°å½•è¿‡ç¨‹** è®°å½•é—®é¢˜æ’æŸ¥è¿‡ç¨‹å’Œè§£å†³æ–¹æ¡ˆ

---

## åä¸€ã€ç›¸å…³èµ„æº

### 11.1 å®˜æ–¹æ–‡æ¡£

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Android Gradle Plugin è¿ç§»æŒ‡å—](https://developer.android.com/build/releases/gradle-plugin)
- [JaCoCo æ–‡æ¡£](https://www.jacoco.org/jacoco/trunk/doc/)

### 11.2 é¡¹ç›®æ–‡æ¡£

- `docs/TESTING.md` - æµ‹è¯•æ¡†æ¶è¯´æ˜
- `docs/è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆ.md` - è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥ï¼ˆå·²è¢«æœ¬æ–‡æ¡£æ•´åˆï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025å¹´1æœˆ  
**ç»´æŠ¤è€…**ï¼šé¡¹ç›®å¼€å‘å›¢é˜Ÿ
