# 应用签名配置说明

## 📋 概述

本文档说明如何为 PhotoTimeGrouper 应用配置签名，以便发布到应用商店。

---

## 一、创建密钥库（Keystore）

### 1.1 使用 keytool 创建密钥库

在项目根目录下执行以下命令：

```bash
keytool -genkey -v -keystore phototimegrouper.keystore -alias phototimegrouper -keyalg RSA -keysize 2048 -validity 10000
```

**参数说明**：
- `-keystore phototimegrouper.keystore`: 密钥库文件名
- `-alias phototimegrouper`: 密钥别名
- `-keyalg RSA`: 密钥算法
- `-keysize 2048`: 密钥大小
- `-validity 10000`: 有效期（天，约 27 年）

**交互式输入**：
- **密钥库密码（storePassword）**：用于保护整个密钥库文件（请妥善保管！）
- **密钥密码（keyPassword）**：用于保护密钥库中的特定密钥别名
  - ⚠️ **重要**：当提示"是否与密钥库密码相同"时，可以选择：
    - **输入相同密码**（推荐，更简单）：直接按回车键
    - **输入不同密码**（更安全）：输入新的密码
  - 大多数情况下，使用**相同密码**即可，这样管理更简单
- 姓名、组织单位、组织、城市、省份、国家代码等信息

### 1.2 验证密钥库

```bash
keytool -list -v -keystore phototimegrouper.keystore
```

---

## 二、配置签名信息

### 2.1 创建 keystore.properties 文件

1. 复制示例文件：
   ```bash
   cp keystore.properties.example keystore.properties
   ```

2. 编辑 `keystore.properties`，填写实际值：
   ```properties
   storeFile=../phototimegrouper.keystore
   storePassword=你的密钥库密码
   keyAlias=phototimegrouper
   keyPassword=你的密钥密码（通常与密钥库密码相同）
   ```
   
   **密码说明**：
   - `storePassword`：密钥库密码（保护整个密钥库文件）
   - `keyPassword`：密钥密码（保护密钥别名）
   - 💡 **如果创建密钥库时选择了相同密码，则两个密码填写相同的值**
   - 💡 **如果创建密钥库时选择了不同密码，则分别填写对应的密码**
   
   **⚠️ 安全提醒**：
   - ⚠️ **密码以明文形式保存在文件中**（这是 Android 构建系统的常见做法）
   - ✅ **`keystore.properties` 已添加到 `.gitignore`，不会被提交到版本控制**
   - ✅ **请确保文件权限设置正确**（仅您自己可读）
   - ✅ **不要将文件分享给他人或上传到任何地方**
   - ✅ **建议使用强密码**，即使文件泄露也能提供一定保护

**⚠️ 重要提醒**：
- `keystore.properties` 文件已添加到 `.gitignore`，不会被提交到版本控制
- 请妥善保管此文件和密钥库文件
- 如果丢失密钥库，将无法更新已发布的应用

---

## 三、验证签名配置

### 3.1 构建 Release 版本

在 Android Studio 中：
1. 选择 `Build` → `Generate Signed Bundle / APK`
2. 选择 `Android App Bundle` 或 `APK`
3. 选择密钥库文件并输入密码
4. 构建 Release 版本

或使用命令行：
```bash
./gradlew assembleRelease
```

### 3.2 验证签名

```bash
# 查看 APK 签名信息
jarsigner -verify -verbose -certs app/build/outputs/apk/release/app-release.apk
```

或使用：
```bash
apksigner verify --print-certs app/build/outputs/apk/release/app-release.apk
```

---

## 四、密钥库备份

### 4.1 备份清单

**必须备份**：
- ✅ `phototimegrouper.keystore` 文件
- ✅ 密钥库密码
- ✅ 密钥别名
- ✅ 密钥密码

**建议**：
- 将密钥库文件备份到多个安全位置（加密存储、云存储等）
- 记录密码到安全的密码管理器
- 不要将密钥库文件提交到版本控制系统

### 4.2 备份命令

```bash
# 创建备份目录
mkdir -p backups

# 备份密钥库
cp phototimegrouper.keystore backups/phototimegrouper.keystore.backup

# 记录密码信息（使用加密方式存储）
# 建议使用密码管理器保存
```

---

## 五、常见问题

### Q1: 如果密钥库丢失了怎么办？
**A**: 如果密钥库丢失，将无法更新已发布的应用。必须使用新的包名重新发布应用。

### Q2: 可以更改密钥库密码吗？
**A**: 可以，使用以下命令：
```bash
keytool -storepasswd -keystore phototimegrouper.keystore
```

### Q3: 可以更改密钥别名吗？
**A**: 不建议更改。如果必须更改，需要重新创建密钥库。

### Q4: 密钥库密码和密钥密码必须相同吗？
**A**: **不是必须的**，但**推荐使用相同密码**：
- ✅ **使用相同密码**（推荐）：
  - 更简单，管理方便
  - 创建密钥库时，当提示"是否与密钥库密码相同"时，直接按回车即可
  - 在 `keystore.properties` 中，`storePassword` 和 `keyPassword` 填写相同的值
- ⚠️ **使用不同密码**（更安全）：
  - 安全性更高，但需要记住两个密码
  - 创建密钥库时，当提示"是否与密钥库密码相同"时，输入 `n`，然后输入新密码
  - 在 `keystore.properties` 中，`storePassword` 和 `keyPassword` 填写不同的值

**建议**：对于个人开发者或小型项目，使用相同密码即可，简单实用。

### Q5: Debug 版本需要签名吗？
**A**: Debug 版本使用 Android SDK 提供的默认调试签名，无需配置。

### Q6: 签名配置后构建失败？
**A**: 检查：
- `keystore.properties` 文件是否存在
- 密钥库文件路径是否正确
- 密码是否正确
- 密钥别名是否正确

### Q7: 密码明文保存在文件中安全吗？
**A**: **这是 Android 构建系统的常见做法**，但需要注意安全：
- ⚠️ 密码确实以明文形式保存在 `keystore.properties` 文件中
- ✅ 文件已添加到 `.gitignore`，不会被提交到版本控制
- ✅ 请确保文件权限设置正确（仅您自己可读）
- ✅ 使用强密码，即使文件泄露也能提供一定保护
- ✅ 不要将文件分享给他人或上传到任何地方
- 💡 **替代方案**：可以使用环境变量或 CI/CD 系统的密钥管理（如 GitHub Secrets），但本地开发通常使用文件方式更简单

---

## 六、安全建议

1. **密钥库文件安全**：
   - 不要将密钥库文件提交到 Git
   - 使用加密存储备份
   - 限制访问权限

2. **密码安全**：
   - 使用强密码
   - 使用密码管理器保存
   - 定期更换密码（如果可能）

3. **团队协作**：
   - 如果多人开发，使用共享的密钥库（安全存储）
   - 或使用 CI/CD 系统管理签名

---

**文档版本**：1.0  
**最后更新**：2024年
