# PhotoTimeGrouper 开发计划（综合版）

## 📋 文档说明

本文档整合了项目开发计划、下一步行动指南、新功能实现计划等内容，重新梳理了后续的开发计划和优先级。

**文档创建时间**：2025年1月  
**当前项目状态**：核心功能已实现，CI/CD 已配置  
**开发模式**：迭代式开发，持续优化

---

## 一、项目当前状态

### ✅ 已完成的核心功能

#### 1.1 基础浏览功能
- ✅ 照片和视频加载（从 MediaStore）
- ✅ 按日期分组显示
- ✅ 四种查看模式（小图标、大图标、超大图标、详细信息列表）
- ✅ 模式切换器（底部导航栏）
- ✅ 模式状态持久化（SharedPreferences）
- ✅ 照片详情查看（ViewPager2 + PhotoView）
- ✅ 视频自动静默播放
- ✅ 视频播放（系统播放器）
- ✅ 下拉刷新

#### 1.2 多选和批量操作（已完成）
- ✅ 长按进入选择模式
- ✅ 多选功能（勾选标记）
- ✅ 批量删除
- ✅ 批量分享
- ✅ 选择操作栏（全选、取消、删除、分享）

#### 1.3 收藏功能（已完成）
- ✅ 收藏/取消收藏照片
- ✅ 收藏筛选视图
- ✅ 收藏状态持久化（SharedPreferences）

#### 1.4 搜索/筛选功能（已完成）
- ✅ 按媒体类型筛选（图片/视频/全部）
- ✅ 按日期范围筛选（近7天、近30天、本年）
- ✅ 筛选对话框

#### 1.5 技术基础设施
- ✅ Kotlin + AndroidX
- ✅ Material Design 3
- ✅ ViewBinding
- ✅ Kotlin Coroutines（异步处理）
- ✅ Glide（图片/视频缩略图加载）
- ✅ 权限管理（Android 13+ 适配）
- ✅ 单元测试框架（JUnit + Mockito）
- ✅ GitHub Actions CI/CD 工作流

---

## 二、待开发功能（按优先级排序）

### 🔥 P0 - 高优先级（核心功能完善）

#### 2.1 数据持久化架构改造
**优先级**：⭐⭐⭐⭐⭐  
**预计时间**：14.5 小时（约 2 个工作日）  
**状态**：✅ **已完成**（2025-01-18）

**目标**：建立数据持久化架构，为后续功能提供数据基础

**任务清单**：
- [x] 引入 Room 数据库依赖
- [x] 创建数据库实体类（PhotoMetadataEntity）
- [x] 创建 DAO 接口（PhotoMetadataDao）
- [x] 创建数据库类（AppDatabase）
- [x] 创建 Repository 层（PhotoRepository）
- [x] 修改 MainActivity 数据加载逻辑（使用 Repository）

**技术要点**：
- Room 数据库用于存储收藏、删除记录、搜索历史等
- Repository 层统一数据访问接口
- 数据同步（MediaStore ↔ Database）

**为什么重要**：
- 当前收藏、筛选等使用 SharedPreferences，功能受限
- Room 数据库支持复杂查询，为搜索、回收站等功能打基础
- 数据持久化是后续高级功能的基础

---

#### 2.2 搜索功能增强
**优先级**：⭐⭐⭐⭐⭐  
**预计时间**：20 小时（约 2.5 个工作日）

**当前状态**：已有基础筛选功能（媒体类型、日期范围）

**需要增强**：
- [ ] 按文件名搜索（模糊匹配）
- [ ] 搜索栏 UI（SearchView）
- [ ] 实时搜索（debounce 300ms）
- [ ] 搜索历史记录（可选）
- [ ] 搜索关键词高亮（可选）

**技术要点**：
- 使用 Room 数据库的 LIKE 查询
- Flow 实现实时搜索
- 搜索索引优化性能

---

#### 2.3 删除功能完善
**优先级**：⭐⭐⭐⭐  
**预计时间**：10 小时（约 1.5 个工作日）

**当前状态**：已有批量删除功能

**需要完善**：
- [ ] 单个删除确认对话框优化
- [ ] 删除失败错误处理优化
- [ ] 删除后自动刷新列表

**注意**：删除功能已实现，主要是优化和错误处理

---

#### 2.4 照片详情信息扩展
**优先级**：⭐⭐⭐⭐  
**预计时间**：8 小时（约 1 个工作日）

**当前状态**：详情页显示名称、日期、索引

**需要扩展**：
- [ ] 显示文件大小、分辨率、格式
- [ ] 显示 EXIF 信息（ISO、光圈、快门速度、相机型号等）
- [ ] 显示 GPS 位置（如果有）
- [ ] 异步加载 EXIF（避免阻塞 UI）

**技术要点**：
- 使用 ExifInterface 读取 EXIF
- 数据已加载（PhotoItem 中已有相关字段）
- 主要是在 UI 上展示

---

### 🎯 P1 - 中优先级（增强功能）

#### 2.5 回收站（最近删除）功能
**优先级**：⭐⭐⭐⭐  
**预计时间**：25 小时（约 3 个工作日）

**目标**：防止误删，支持恢复已删除的照片

**任务清单**：
- [ ] 修改删除逻辑（软删除，标记 `isDeleted = true`）
- [ ] 创建回收站界面（TrashActivity/Fragment）
- [ ] 实现恢复功能
- [ ] 实现彻底删除功能
- [ ] 自动清理（WorkManager，超过30天自动删除）
- [ ] 添加回收站入口

**技术要点**：
- 软删除：不删除文件，仅标记数据库状态
- WorkManager 实现后台清理任务
- 恢复时清除删除标记

---

#### 2.6 分享功能增强
**优先级**：⭐⭐⭐  
**预计时间**：5 小时（约 0.5 个工作日）

**当前状态**：已有批量分享功能

**需要增强**：
- [ ] 优化分享体验
- [ ] 处理大文件分享
- [ ] 分享进度提示（可选）
- [ ] FileProvider 配置优化

**注意**：分享功能已实现，主要是优化

---

#### 2.7 相册/文件夹管理
**优先级**：⭐⭐⭐  
**预计时间**：22 小时（约 3 个工作日）

**目标**：支持按文件夹浏览照片，创建自定义相册

**任务清单**：
- [ ] 读取文件夹信息（从 MediaStore）
- [ ] 创建文件夹浏览界面
- [ ] 实现文件夹详情（文件夹内照片列表）
- [ ] 创建自定义相册（可选）
- [ ] 添加相册入口

**技术要点**：
- MediaStore 的 BUCKET_DISPLAY_NAME 字段
- 按文件夹分组照片
- 自定义相册需要数据库支持

---

### ⚡ P2 - 低优先级（高级功能）

#### 2.8 基础编辑功能
**优先级**：⭐⭐⭐  
**预计时间**：18 小时（约 2.5 个工作日）

**目标**：实现照片的基础编辑功能

**任务清单**：
- [ ] 选择编辑库（PhotoEditor 或 uCrop）
- [ ] 集成编辑功能（裁剪、旋转、调整亮度/对比度/饱和度）
- [ ] 编辑界面 UI
- [ ] 在详情页集成编辑入口
- [ ] 保存编辑后的照片

**技术要点**：
- 使用第三方编辑库（PhotoEditor）
- 或使用系统编辑 Intent（简单但功能有限）

---

#### 2.9 隐藏相册/私密相册
**优先级**：⭐⭐⭐  
**预计时间**：18 小时（约 2.5 个工作日）

**目标**：保护用户隐私

**任务清单**：
- [ ] 数据库扩展（添加 `isHidden` 字段）
- [ ] 实现隐藏逻辑
- [ ] 创建私密相册界面
- [ ] 密码保护（可选，使用 Android KeyStore）
- [ ] 添加入口

---

#### 2.10 幻灯片播放
**优先级**：⭐⭐  
**预计时间**：18 小时（约 2.5 个工作日）

**目标**：自动幻灯片播放功能

**任务清单**：
- [ ] 创建幻灯片界面
- [ ] 实现自动播放（定时器）
- [ ] 转场效果（可选）
- [ ] 背景音乐（可选）
- [ ] 添加入口和配置

---

#### 2.11 筛选和排序增强
**优先级**：⭐⭐  
**预计时间**：13 小时（约 2 个工作日）

**当前状态**：已有基础筛选功能

**需要增强**：
- [ ] 按大小筛选
- [ ] 组合筛选（类型 + 大小 + 日期）
- [ ] 排序功能（按日期、名称、大小）
- [ ] 保存用户偏好

---

### 🚀 P3 - 长期规划（高级特性）

#### 2.12 AI 智能分类
**优先级**：⭐⭐  
**预计时间**：20-40 小时

**功能**：
- 人物识别与分组
- 地点识别（GPS）
- 场景识别（宠物、食物、建筑等）
- 自动创建智能相册

**技术要点**：
- 集成 AI 模型（ML Kit 或自建模型）
- 可能需要云端服务支持

---

#### 2.13 云端同步
**优先级**：⭐  
**预计时间**：40-60 小时

**功能**：
- 集成云存储服务
- 自动备份
- 多设备同步

---

#### 2.14 高级编辑
**优先级**：⭐  
**预计时间**：30-50 小时

**功能**：
- 滤镜效果
- 美颜功能
- 视频剪辑
- 拼图/拼贴功能

---

## 三、开发优先级和时间规划

### 第一阶段：核心功能完善（2-3 周）

**目标**：完善核心功能，提升基础体验

**任务列表**：
1. ✅ **数据持久化架构改造**（14.5 小时）- P0
2. ✅ **搜索功能增强**（20 小时）- P0
3. ✅ **照片详情信息扩展**（8 小时）- P0
4. ✅ **删除功能完善**（10 小时）- P0

**预计总时间**：约 52.5 小时（约 6-7 个工作日）

**里程碑**：核心功能完善，用户体验提升

---

### 第二阶段：增强功能开发（2-3 周）

**目标**：添加实用功能，提升应用价值

**任务列表**：
1. **回收站功能**（25 小时）- P1
2. **相册/文件夹管理**（22 小时）- P1
3. **分享功能增强**（5 小时）- P1
4. **筛选和排序增强**（13 小时）- P2

**预计总时间**：约 65 小时（约 8 个工作日）

**里程碑**：功能相对完善，可以发布 Beta 版本

---

### 第三阶段：高级功能（长期）

**目标**：添加高级特性，提升竞争力

**任务列表**：
1. **基础编辑功能**（18 小时）- P2
2. **隐藏相册**（18 小时）- P2
3. **幻灯片播放**（18 小时）- P2
4. **AI 智能分类**（长期）- P3
5. **云端同步**（长期）- P3

---

## 四、开发建议

### 4.1 立即开始的任务（推荐）

**P0 任务按顺序执行**：

1. **数据持久化架构改造**（最重要）
   - 这是后续功能的基础
   - 影响搜索、回收站、自定义相册等功能

2. **搜索功能增强**
   - 用户期望的功能
   - 提升用户体验

3. **照片详情信息扩展**
   - 相对简单，快速完成
   - 提升应用专业性

### 4.2 开发注意事项

**1. 数据架构优先**
- 先完成数据持久化架构，再开发依赖数据的功能
- 避免后期大规模重构

**2. 功能验证**
- 每个功能完成后充分测试
- 利用已建立的 CI/CD 自动测试

**3. 代码质量**
- 保持代码整洁
- 遵循已有的代码规范
- 及时提交代码

**4. 用户体验**
- 每个新功能都要考虑用户体验
- 提供友好的错误提示
- 保持界面响应流畅

---

## 五、当前已完成 vs 待开发对比

### ✅ 已完成功能清单

#### 核心浏览功能
- ✅ 照片和视频加载
- ✅ 按日期分组显示
- ✅ 四种查看模式
- ✅ 详情查看（图片缩放、视频播放）
- ✅ 下拉刷新

#### 管理功能
- ✅ 多选和批量操作
- ✅ 批量删除
- ✅ 批量分享
- ✅ 收藏功能
- ✅ 基础筛选（媒体类型、日期范围）

#### 技术基础设施
- ✅ CI/CD 工作流
- ✅ 单元测试框架
- ✅ 代码质量保证

---

### 🚧 待开发功能清单

#### 高优先级（P0）
- ⏳ 数据持久化架构（Room 数据库）
- ⏳ 搜索功能增强（文件名搜索）
- ⏳ 照片详情信息扩展（EXIF 信息）
- ⏳ 删除功能完善（错误处理优化）

#### 中优先级（P1）
- ⏳ 回收站（最近删除）功能
- ⏳ 相册/文件夹管理
- ⏳ 分享功能增强

#### 低优先级（P2）
- ⏳ 基础编辑功能
- ⏳ 隐藏相册/私密相册
- ⏳ 幻灯片播放
- ⏳ 筛选和排序增强

#### 长期规划（P3）
- ⏳ AI 智能分类
- ⏳ 云端同步
- ⏳ 高级编辑

---

## 六、推荐开发路线图

### 短期路线（1-2 个月）

```
Week 1-2: 数据持久化架构改造
    ↓
Week 2-3: 搜索功能增强
    ↓
Week 3: 照片详情信息扩展
    ↓
Week 4: 删除功能完善 + 测试
```

### 中期路线（2-3 个月）

```
Month 2: 回收站功能
    ↓
Month 3: 相册/文件夹管理
    ↓
Month 3: 筛选和排序增强
```

### 长期路线（3+ 个月）

```
根据用户反馈和需求
    ↓
基础编辑功能
    ↓
隐藏相册、幻灯片播放
    ↓
高级特性（AI、云端同步）
```

---

## 七、版本规划

### v0.9.0 - Beta 版本（第一阶段完成后）

**功能**：
- 数据持久化架构
- 搜索功能增强
- 照片详情信息扩展

**目标**：内部测试和少量用户测试

---

### v1.0.0 - 正式版本（第二阶段完成后）

**功能**：
- 核心功能 + 增强功能
- 回收站功能
- 相册/文件夹管理

**目标**：公开发布

---

### v1.1.0+ - 后续版本

- 根据用户反馈持续迭代
- 修复 bug
- 性能优化
- 可能添加 P2/P3 功能

---

## 八、技术债务和优化

### 8.1 架构优化

**当前问题**：
- 业务逻辑集中在 Activity
- 数据无持久化（SharedPreferences 限制）

**建议改进**：
- 引入 Repository 层（Phase 1 优先级任务）
- 逐步重构为 MVVM 架构

### 8.2 性能优化

**待优化项**：
- 大量照片加载时使用分页
- 图片缓存策略优化
- 内存管理优化

### 8.3 代码质量

**持续改进**：
- 保持代码整洁
- 完善单元测试
- 提高测试覆盖率

---

## 九、风险与应对

### 9.1 技术风险

**风险 1：数据同步复杂**
- 影响：数据不一致
- 应对：设计好同步策略，充分测试

**风险 2：性能问题**
- 影响：应用卡顿
- 应对：性能测试，优化算法，使用分页加载

### 9.2 时间风险

**风险：开发时间超出预期**
- 应对：
  - 按优先级实现功能
  - 先实现核心功能
  - 保持代码质量

---

## 十、总结

### 当前状态

**已完成**：
- ✅ 核心浏览功能
- ✅ 多选和批量操作
- ✅ 收藏功能
- ✅ 基础筛选
- ✅ CI/CD 工作流

**待完成**：
- ⏳ 数据持久化架构（最优先）
- ⏳ 搜索功能增强
- ⏳ 照片详情信息扩展
- ⏳ 回收站功能

### 推荐下一步行动

1. **立即开始**：数据持久化架构改造（P0，最重要）
2. **接着进行**：搜索功能增强（P0）
3. **然后完成**：照片详情信息扩展（P0，相对简单）

### 成功因素

1. **优先级明确**：先实现核心功能，再逐步增强
2. **代码质量**：保持代码整洁，便于维护
3. **测试充分**：利用 CI/CD 自动测试
4. **用户反馈**：及时收集反馈，快速迭代

---

**文档版本**：2.0（综合版）  
**最后更新**：2025年1月  
**维护者**：项目开发团队
