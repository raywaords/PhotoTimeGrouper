# 运行集成测试指南

本文档提供多种运行集成测试的方法，适用于不同版本的 Android Studio。

## 🔧 前提条件

1. **同步项目**
   - `File → Sync Project with Gradle Files`
   - 等待同步完成（下载依赖、构建项目）

2. **连接设备或启动模拟器**
   - 连接 Android 设备并启用 USB 调试
   - 或启动 Android 模拟器
   - 在 Android Studio 底部状态栏可以看到设备信息

## 📱 方法 1: 通过 Gradle 面板运行（最常用）

### 步骤：

1. **打开 Gradle 面板**
   - 点击右侧边栏的 **"Gradle"** 标签
   - 如果没有看到，可以：
     - `View → Tool Windows → Gradle`
     - 或点击右侧边栏的图标

2. **展开项目结构**
   ```
   PhotoTimeGrouper
     └── app
         └── Tasks
             └── verification
                 └── connectedAndroidTest  ← 双击这里
   ```

3. **运行测试**
   - 双击 `connectedAndroidTest`
   - 或右键点击 → `Run 'connectedAndroidTest'`

4. **选择目标设备**
   - 如果连接了多个设备，会弹出设备选择对话框
   - 选择要使用的设备或模拟器

5. **查看测试结果**
   - 测试运行完成后，结果会显示在底部的 `Run` 面板
   - 或在 `Build` 面板查看构建日志

## 🎯 方法 2: 通过测试文件运行

### 运行整个测试类：

1. **打开测试文件**
   - 打开 `app/src/androidTest/java/com/example/phototimegrouper/PhotoLoadingIntegrationTest.kt`

2. **点击运行按钮**
   - 在类名 `class PhotoLoadingIntegrationTest` 左侧找到绿色运行图标 ▶️
   - 点击运行图标
   - 选择 `Run 'PhotoLoadingIntegrationTest'`

3. **选择目标设备**
   - 如果有多个设备，选择要使用的设备

### 运行单个测试方法：

1. **打开测试文件**
2. **找到测试方法**（如 `testCompletePhotoLoadingFlow()`）
3. **点击方法名旁边的绿色运行图标** ▶️
4. **选择 `Run 'testCompletePhotoLoadingFlow()'`**

## 🛠️ 方法 3: 使用 Run Configuration

### 创建自定义运行配置：

1. **点击运行配置下拉菜单**
   - 在 Android Studio 顶部工具栏
   - 通常显示 "app" 或当前配置

2. **编辑配置**
   - 点击下拉菜单 → `Edit Configurations...`
   - 或 `Run → Edit Configurations...`

3. **创建新配置**
   - 点击左上角的 **`+`** 按钮
   - 选择 **`Android Instrumented Tests`**

4. **配置参数**
   - **Name**: `All Integration Tests`（或任何名称）
   - **Module**: 选择 `app`
   - **Test**: 选择 `All in Package`
   - **Package**: `com.example.phototimegrouper`
   - **Target device**: 选择 `Show device chooser dialog`

5. **保存并运行**
   - 点击 `OK` 保存
   - 从运行配置下拉菜单选择新创建的配置
   - 点击运行按钮 ▶️

## 💻 方法 4: 使用 Gradle 命令（命令行）

### 在 Android Studio 的 Terminal 中：

```bash
# 运行所有 Instrumented 测试
./gradlew connectedAndroidTest

# Windows（如果上面的命令不工作）
gradlew.bat connectedAndroidTest
```

### 运行特定测试类：

```bash
# 运行 PhotoLoadingIntegrationTest
./gradlew connectedAndroidTest --tests "com.example.phototimegrouper.PhotoLoadingIntegrationTest"

# 运行 PhotoNavigationIntegrationTest
./gradlew connectedAndroidTest --tests "com.example.phototimegrouper.PhotoNavigationIntegrationTest"

# 运行 PhotoDataFlowIntegrationTest
./gradlew connectedAndroidTest --tests "com.example.phototimegrouper.PhotoDataFlowIntegrationTest"
```

### 运行特定测试方法：

```bash
./gradlew connectedAndroidTest --tests "com.example.phototimegrouper.PhotoLoadingIntegrationTest.testCompletePhotoLoadingFlow"
```

## 🔍 方法 5: 通过项目视图运行（如果可用）

某些 Android Studio 版本可能支持：

1. **切换到 Project 视图**
   - 点击左侧边栏的 "Project" 标签

2. **找到测试目录**
   - 导航到 `app/src/androidTest/java/com/example/phototimegrouper/`

3. **右键菜单选项**
   - 右键点击 `androidTest` 文件夹
   - 查看是否有 `Run 'All Tests'` 或类似选项
   - 如果看到 `Run Tests` 或 `Run 'Tests in 'androidTest''`，点击它

## ⚠️ 如果看不到运行选项

### 问题排查：

1. **项目未同步**
   - `File → Sync Project with Gradle Files`
   - 等待同步完成

2. **Gradle 构建失败**
   - 检查 `Build` 面板是否有错误
   - 修复错误后重新同步

3. **测试文件未识别**
   - 确保测试文件在 `app/src/androidTest/` 目录下
   - 确保测试类有 `@RunWith(AndroidJUnit4::class)` 注解
   - 确保测试方法有 `@Test` 注解

4. **Android Studio 版本问题**
   - 某些旧版本可能不支持某些功能
   - 推荐使用 Android Studio Hedgehog 或更新版本

5. **设备未连接**
   - 检查设备管理器中是否有设备
   - `View → Tool Windows → Device Manager`
   - 确保设备已连接并启用 USB 调试

## ✅ 推荐的工作流程

**最简单的方法**（推荐）：

1. **打开测试文件**（如 `PhotoLoadingIntegrationTest.kt`）
2. **点击类名旁边的绿色运行按钮** ▶️
3. **选择目标设备**
4. **查看测试结果**

这是最直接、最可靠的方法！

## 📊 查看测试结果

### 在 Android Studio 中：

- **Run 面板**：显示测试执行过程和结果
  - ✅ 绿色 = 通过
  - ❌ 红色 = 失败
  - 点击失败的测试查看详细错误信息

### 测试报告：

测试运行完成后，可以查看 HTML 报告：

**位置**：
```
app/build/reports/androidTests/connected/index.html
```

在浏览器中打开此文件查看详细的测试报告。

## 🎯 快速测试清单

运行测试前检查：

- [ ] 项目已同步（`File → Sync Project with Gradle Files`）
- [ ] 设备/模拟器已连接
- [ ] 设备上已启用 USB 调试（真实设备）
- [ ] 测试文件在正确的位置（`app/src/androidTest/`）
- [ ] 测试类有正确的注解（`@RunWith(AndroidJUnit4::class)`）
- [ ] 测试方法有 `@Test` 注解

## 💡 小技巧

1. **快速运行**：使用快捷键 `Ctrl+Shift+F10`（Windows/Linux）或 `Ctrl+Shift+R`（Mac）运行当前测试

2. **重新运行**：在 Run 面板中点击重新运行按钮 🔄

3. **查看日志**：在 Run 面板中可以看到详细的测试日志

4. **过滤结果**：在 Run 面板中可以过滤查看通过的或失败的测试

---

**如果以上方法都不工作**，请检查：
1. Android Studio 版本是否过旧
2. 项目是否成功同步
3. 是否有构建错误
4. 设备是否正确连接

推荐使用**方法 2**（通过测试文件运行），这是最通用的方法！
